<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WatchingCat - OpenTelemetry Observability Platform</title>
    <link rel="stylesheet" href="/static/css/modern-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-cat"></i>
                <span>WatchingCat</span>
                <span class="nav-subtitle">Observability Platform</span>
            </div>
            <div class="nav-links">
                <a href="#dashboard" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="#services" class="nav-link" data-page="services">
                    <i class="fas fa-server"></i> Services
                </a>
                <a href="#traces" class="nav-link" data-page="traces">
                    <i class="fas fa-project-diagram"></i> Traces
                </a>
                <a href="#metrics" class="nav-link" data-page="metrics">
                    <i class="fas fa-chart-line"></i> Metrics
                </a>
                <a href="#shop" class="nav-link" data-page="shop">
                    <i class="fas fa-shopping-cart"></i> Demo Shop
                </a>
            </div>
            <div class="nav-actions">
                <button class="btn btn-sm btn-outline" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn btn-sm btn-primary" onclick="refreshAll()">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page active">
            <!-- Status Banner -->
            <div class="status-banner">
                <div class="status-item">
                    <i class="fas fa-circle status-indicator" id="system-status"></i>
                    <span>System Status: <strong id="system-status-text">Checking...</strong></span>
                </div>
                <div class="status-item">
                    <i class="fas fa-clock"></i>
                    <span>Uptime: <strong id="system-uptime">--</strong></span>
                </div>
                <div class="status-item">
                    <i class="fas fa-sync"></i>
                    <span>Last Updated: <strong id="last-update">--</strong></span>
                </div>
            </div>

            <!-- Key Metrics -->
            <div class="metrics-row">
                <div class="metric-card primary">
                    <div class="metric-header">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Request Rate</span>
                    </div>
                    <div class="metric-value" id="metric-request-rate">--</div>
                    <div class="metric-label">requests/sec</div>
                    <div class="metric-trend positive">
                        <i class="fas fa-arrow-up"></i> 12.5%
                    </div>
                </div>

                <div class="metric-card success">
                    <div class="metric-header">
                        <i class="fas fa-check-circle"></i>
                        <span>Success Rate</span>
                    </div>
                    <div class="metric-value" id="metric-success-rate">--</div>
                    <div class="metric-label">percentage</div>
                    <div class="metric-trend positive">
                        <i class="fas fa-arrow-up"></i> 2.1%
                    </div>
                </div>

                <div class="metric-card warning">
                    <div class="metric-header">
                        <i class="fas fa-clock"></i>
                        <span>Avg Latency</span>
                    </div>
                    <div class="metric-value" id="metric-latency">--</div>
                    <div class="metric-label">milliseconds</div>
                    <div class="metric-trend negative">
                        <i class="fas fa-arrow-down"></i> 8.3%
                    </div>
                </div>

                <div class="metric-card danger">
                    <div class="metric-header">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Error Rate</span>
                    </div>
                    <div class="metric-value" id="metric-error-rate">--</div>
                    <div class="metric-label">percentage</div>
                    <div class="metric-trend positive">
                        <i class="fas fa-arrow-down"></i> 15.2%
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-area"></i> Request Volume</h3>
                        <select class="chart-timerange" onchange="updateCharts(this.value)">
                            <option value="5m">Last 5 minutes</option>
                            <option value="15m" selected>Last 15 minutes</option>
                            <option value="1h">Last hour</option>
                            <option value="24h">Last 24 hours</option>
                        </select>
                    </div>
                    <canvas id="requestVolumeChart"></canvas>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-line"></i> Response Times</h3>
                        <div class="chart-legend">
                            <span class="legend-item"><span class="legend-dot p50"></span>P50</span>
                            <span class="legend-item"><span class="legend-dot p95"></span>P95</span>
                            <span class="legend-item"><span class="legend-dot p99"></span>P99</span>
                        </div>
                    </div>
                    <canvas id="latencyChart"></canvas>
                </div>
            </div>

            <!-- Service Topology -->
            <div class="topology-section">
                <div class="section-header">
                    <h2><i class="fas fa-project-diagram"></i> Service Topology</h2>
                    <button class="btn btn-sm btn-outline" onclick="resetTopology()">
                        <i class="fas fa-expand-arrows-alt"></i> Reset View
                    </button>
                </div>
                <div id="service-topology" class="topology-container"></div>
            </div>

            <!-- Observability Tools Grid -->
            <div class="tools-section">
                <h2><i class="fas fa-tools"></i> Observability Stack</h2>
                <div class="tools-grid">
                    <a href="{{.JaegerURL}}" target="_blank" class="tool-card jaeger">
                        <div class="tool-icon">
                            <i class="fas fa-route"></i>
                        </div>
                        <div class="tool-content">
                            <h3>Jaeger</h3>
                            <p>Distributed tracing and request flow analysis</p>
                            <div class="tool-stats">
                                <span><i class="fas fa-project-diagram"></i> <span id="jaeger-traces">--</span>
                                    traces</span>
                            </div>
                        </div>
                        <span class="tool-action">Open <i class="fas fa-external-link-alt"></i></span>
                    </a>

                    <a href="{{.GrafanaURL}}" target="_blank" class="tool-card grafana">
                        <div class="tool-icon">
                            <i class="fas fa-chart-area"></i>
                        </div>
                        <div class="tool-content">
                            <h3>Grafana</h3>
                            <p>Metrics visualization and custom dashboards</p>
                            <div class="tool-stats">
                                <span><i class="fas fa-dashboard"></i> 3 dashboards</span>
                            </div>
                        </div>
                        <span class="tool-action">Open <i class="fas fa-external-link-alt"></i></span>
                    </a>

                    <a href="{{.PrometheusURL}}" target="_blank" class="tool-card prometheus">
                        <div class="tool-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="tool-content">
                            <h3>Prometheus</h3>
                            <p>Time-series metrics collection and alerting</p>
                            <div class="tool-stats">
                                <span><i class="fas fa-database"></i> <span id="prom-metrics">--</span> metrics</span>
                            </div>
                        </div>
                        <span class="tool-action">Open <i class="fas fa-external-link-alt"></i></span>
                    </a>

                    <a href="{{.KibanaURL}}" target="_blank" class="tool-card kibana">
                        <div class="tool-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="tool-content">
                            <h3>Kibana</h3>
                            <p>Log search, analysis, and visualization</p>
                            <div class="tool-stats">
                                <span><i class="fas fa-file-alt"></i> <span id="kibana-logs">--</span> logs</span>
                            </div>
                        </div>
                        <span class="tool-action">Open <i class="fas fa-external-link-alt"></i></span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Services Page -->
        <div id="page-services" class="page">
            <div class="page-header">
                <h1><i class="fas fa-server"></i> Microservices Overview</h1>
                <p>Monitor health, performance, and dependencies of all services</p>
            </div>

            <div id="services-grid" class="services-grid"></div>
        </div>

        <!-- Traces Page -->
        <div id="page-traces" class="page">
            <div class="page-header">
                <h1><i class="fas fa-project-diagram"></i> Distributed Traces</h1>
                <p>Explore request flows across microservices</p>
            </div>

            <div class="traces-filters">
                <input type="text" class="form-input" placeholder="Search by Trace ID or Service..." id="trace-search">
                <select class="form-select" id="trace-service-filter">
                    <option value="">All Services</option>
                    <option value="frontend">Frontend</option>
                    <option value="cartservice">Cart Service</option>
                    <option value="productcatalog">Product Catalog</option>
                    <option value="checkoutservice">Checkout Service</option>
                </select>
                <button class="btn btn-primary" onclick="searchTraces()">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>

            <div id="traces-list" class="traces-list"></div>
        </div>

        <!-- Metrics Page -->
        <div id="page-metrics" class="page">
            <div class="page-header">
                <h1><i class="fas fa-chart-line"></i> System Metrics</h1>
                <p>Real-time performance and resource utilization</p>
            </div>

            <div class="metrics-dashboard">
                <div class="metric-chart-card">
                    <h3><i class="fas fa-microchip"></i> CPU Usage by Service</h3>
                    <canvas id="cpuChart"></canvas>
                </div>

                <div class="metric-chart-card">
                    <h3><i class="fas fa-memory"></i> Memory Usage by Service</h3>
                    <canvas id="memoryChart"></canvas>
                </div>

                <div class="metric-chart-card span-2">
                    <h3><i class="fas fa-network-wired"></i> Network Throughput</h3>
                    <canvas id="networkChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Demo Shop Page -->
        <div id="page-shop" class="page">
            <div class="page-header">
                <h1><i class="fas fa-shopping-cart"></i> Observatory Shop Demo</h1>
                <p>Interactive e-commerce demo to generate realistic telemetry data</p>
            </div>

            <div class="shop-container">
                <div class="product-grid" id="product-grid"></div>

                <div class="shop-sidebar">
                    <div class="cart-card">
                        <h3><i class="fas fa-shopping-cart"></i> Shopping Cart</h3>
                        <div id="cart-items" class="cart-items"></div>
                        <div class="cart-footer">
                            <div class="cart-total">
                                Total: <strong id="cart-total">$0.00</strong>
                            </div>
                            <button class="btn btn-success btn-block" onclick="checkout()">
                                <i class="fas fa-credit-card"></i> Checkout
                            </button>
                        </div>
                    </div>

                    <div class="loadgen-card">
                        <h3><i class="fas fa-robot"></i> Load Generator</h3>
                        <p>Simulate automated shopping behavior</p>
                        <div class="loadgen-status">
                            <span>Status:</span>
                            <span id="loadgen-status" class="status-badge">Stopped</span>
                        </div>
                        <div class="loadgen-controls">
                            <button class="btn btn-success btn-block" onclick="startLoadGen()">
                                <i class="fas fa-play"></i> Start
                            </button>
                            <button class="btn btn-danger btn-block" onclick="stopLoadGen()">
                                <i class="fas fa-stop"></i> Stop
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="/static/js/modern-app.js"></script>
</body>

</html>